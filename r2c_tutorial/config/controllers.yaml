controller_manager:
  ros__parameters:
    update_rate: 50  # Hz - Controller update frequency

    # List of controllers to be activated on startup
    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster

    diff_drive_controller:
      type: diff_drive_controller/DiffDriveController

    arm_position_controller:
      type: joint_trajectory_controller/JointTrajectoryController
    
    # Sensor state broadcaster - reads sensor states and publishes ROS messages
    sensor_state_broadcaster:
      type: r2c_tutorial/SensorStateBroadcaster
    
    # Sensor command controller - writes commands to sensor interfaces (simulation only)
    sensor_command_controller:
      type: r2c_tutorial/SensorCommandController

    # For manual testing with joint_state_publisher_gui
    forward_position_controller:
      type: forward_command_controller/ForwardCommandController

# =============================================================================
# JOINT STATE BROADCASTER
# Publishes the state of all joints to /joint_states topic
# This is essential for robot_state_publisher and RViz visualization
# =============================================================================
joint_state_broadcaster:
  ros__parameters:
    joints:
      - left_wheel_joint
      - right_wheel_joint
      - arm_joint
    interfaces:
      - position
      - velocity

# =============================================================================
# DIFFERENTIAL DRIVE CONTROLLER
# Converts cmd_vel (linear/angular) to wheel velocities
# Publishes odometry from wheel encoders
# =============================================================================
diff_drive_controller:
  ros__parameters:
    # Joint names
    left_wheel_names: ["left_wheel_joint"]
    right_wheel_names: ["right_wheel_joint"]

    # Robot geometry - CRITICAL for accurate odometry
    wheel_separation: 0.40      # Distance between wheels (meters)
    wheel_radius: 0.05          # Wheel radius (meters)

    # Fine-tuning multipliers (set to 1.0 initially)
    wheel_separation_multiplier: 1.0
    left_wheel_radius_multiplier: 1.0
    right_wheel_radius_multiplier: 1.0

    # Publishing settings
    publish_rate: 50.0          # Hz - How often to publish odometry
    odom_frame_id: "odom"       # Odometry frame name
    base_frame_id: "base_link"  # Robot base frame name
    pose_covariance_diagonal: [0.001, 0.001, 0.001, 0.001, 0.001, 0.01]
    twist_covariance_diagonal: [0.001, 0.001, 0.001, 0.001, 0.001, 0.01]

    # Control settings
    open_loop: false            # Use feedback control (not open-loop)
    enable_odom_tf: true        # Publish odom->base_link transform

    # Command velocity timeout
    cmd_vel_timeout: 0.5        # Stop robot if no cmd_vel for 0.5 seconds
    
    # Velocity rolling window for smoothing
    #velocity_rolling_window_size: 10

    # Use stamped velocity messages - SET TO FALSE for teleop compatibility
    use_stamped_vel: false

    # Linear velocity limits (X axis - forward/backward)
    linear.x.has_velocity_limits: true
    linear.x.has_acceleration_limits: true
    linear.x.has_jerk_limits: false
    linear.x.max_velocity: 1.0          # m/s
    linear.x.min_velocity: -1.0         # m/s
    linear.x.max_acceleration: 2.0      # m/s²
    linear.x.min_acceleration: -2.0     # m/s²

    # Angular velocity limits (Z axis - rotation)
    angular.z.has_velocity_limits: true
    angular.z.has_acceleration_limits: true
    angular.z.has_jerk_limits: false
    angular.z.max_velocity: 2.0         # rad/s
    angular.z.min_velocity: -2.0        # rad/s
    angular.z.max_acceleration: 4.0     # rad/s²
    angular.z.min_acceleration: -4.0    # rad/s²

# =============================================================================
# ARM POSITION CONTROLLER
# Controls the arm joint using position commands
# Supports trajectory following for smooth motion
# =============================================================================
arm_position_controller:
  ros__parameters:
    joints:
      - arm_joint

    # Command interfaces - what we send to the hardware
    command_interfaces:
      - position

    # State interfaces - what we read from the hardware
    state_interfaces:
      - position
      - velocity

    # Action server configuration
    action_monitor_rate: 20.0   # Hz

    # Constraints for trajectory execution
    constraints:
      stopped_velocity_tolerance: 0.01  # rad/s
      goal_time: 0.0  # If zero, no time constraint on reaching goal

    # Path tolerance (how much deviation allowed during motion)
    arm_joint:
      trajectory: 0.05          # radians
      goal: 0.01                # radians - tighter tolerance at goal

    # State publishing
    state_publish_rate: 50.0    # Hz

# =============================================================================
# FORWARD POSITION CONTROLLER
# Simple pass-through controller for manual testing
# Can be used with joint_state_publisher_gui for direct joint control
# =============================================================================
forward_position_controller:
  ros__parameters:
    joints:
      - left_wheel_joint
      - right_wheel_joint
      - arm_joint
    interface_name: position

# =============================================================================
# SENSOR STATE BROADCASTER
# Reads sensor state interfaces and publishes as ROS messages
# State interfaces: temperature, voltage, current, range
# Publications: ~/temperature, ~/battery, ~/range
# =============================================================================
sensor_state_broadcaster:
  ros__parameters:
    # Sensor names (must match hardware interface)
    temperature_sensor_name: "temperature_sensor"
    battery_sensor_name: "battery_sensor"      # Combined voltage + current
    range_sensor_name: "range_sensor"
    
    # Frame IDs for published messages
    temperature_frame_id: "temperature_sensor"
    battery_frame_id: "base_link"
    range_frame_id: "temperature_sensor"  # Mounted on arm tip
    
    # Publishing rate
    publish_rate: 10.0  # Hz

# =============================================================================
# SENSOR COMMAND CONTROLLER (SIMULATION ONLY)
# Writes commands to sensor command interfaces for testing
# Subscribed topics: ~/temperature_cmd, ~/voltage_cmd, ~/current_cmd, ~/range_cmd
# Command interfaces: temperature, voltage, current, range
# =============================================================================
sensor_command_controller:
  ros__parameters:
    # Sensor names (must match hardware interface)
    temperature_sensor_name: "temperature_sensor"
    battery_sensor_name: "battery_sensor"      # Combined voltage + current
    range_sensor_name: "range_sensor"



