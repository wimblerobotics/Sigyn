While I test your code fixes, please create a new package called "perimeter_roamer_v3". I can be written in either C++ or python, or a combination. I already have the nav2 stack running and have created a robust map of the whole house. You could examing the map, if you wanted, and write code to recognize rooms, though I have a database in ~/sigyn_ws/walls.db which already has some sense of where walls are in the house if that is of use. I'm happy to use a behavior tree approach if that would be a better approach, but you'd have to help me write all the nodes, especially leaf nodes to recognize all the conditionis that you'd need for hte tree. Or you could look at the map itself and the local and global costmaps and do a more heuristic approach. I want a fairly robust and complete solution. I like the behavior tree approach as it allows me to later insert reactive behavior, like checking for battery depletion or other safety violations later on, but I don't require that you use a behavior tree approach. Think deeply on this. Do research on other people's attempt to solve this and when you think you have found a good approach build a well formed package that runs on ros2/jazzy. My main launch file to bring up the stack is in base/launch/sigyn.launch.py. I'm testing this first in simulation using gazebo harmonic but I have a real robot called Sigyn as well. The gazebo simulator apparently puts out a fair number of infinity readings in the lidar simulator, so you have to be able to ignore them. Ask questions if I can help.